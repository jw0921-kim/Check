
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>전체 현황 보기</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #f3e5f5, #e3f2fd);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      color: #333;
    }

    .dashboard {
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }

    .panel {
      flex: 1;
      background: white;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .panel h2 {
      margin-bottom: 8px;
      font-size: 18px;
      color: #444;
    }

    .group {
      width: 100%;
      margin: 4px 0;
    }

    .group-title {
      text-align: center;
      font-size: 14px;
      font-weight: bold;
      color: #666;
      margin: 4px 0;
    }

    .names {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      padding: 0 4px;
    }

    .name {
      text-align: center;
      padding: 6px 4px;
      border-radius: 8px;
      font-size: 13px;
      background: #f0f0f0;
      border: 1px solid #ccc;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .present {
      background: #e6f4ea !important;
      border: 2px solid #81c784;
      color: #2e7d32;
      font-weight: bold;
    }

  </style>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>

</head>
<body>
  <h1>전체 출석 현황 보기</h1>
  <div style="text-align:center; margin-bottom: 20px;">
    <input id="datePicker" type="text" style="padding: 8px; font-size: 16px; border-radius: 6px; border: 1px solid #ccc; text-align: center;" />
  </div>

  <div class="dashboard" id="dashboard">
    <!-- JavaScript will inject the 3 panels here -->
  </div>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDrHDHrYO2Z8tWmWRgWYcN4nWHwALZ4c0s",
      authDomain: "attendance-6b1b6.firebaseapp.com",
      databaseURL: "https://attendance-6b1b6-default-rtdb.firebaseio.com",
      projectId: "attendance-6b1b6",
      storageBucket: "attendance-6b1b6.appspot.com",
      messagingSenderId: "808077953334",
      appId: "1:808077953334:web:238afede21744aee6f8b97"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const departments = [
      {
        name: "겸손부",
        brothers: ["이태섭", "김진우", "이동환", "김지석", "전도영", "김권비", "김민호", "남준혁", "최재혁", "김인수", "문지훈", "전호성", "박지웅", "김두현", "박효원"],
        sisters: ["전효진", "고다영", "남소연", "김유나", "정여진", "심규리", "김민서", "박지혜", "심재경", "유지연", "심예림", "이소희", "임도해", "이현화", "김소은", "김이안"]
      },
      {
        name: "온유부",
        brothers: ["양인수", "김호진", "이상수", "정형기", "박수용", "고병인", "이동길", "정인교", "권세빈", "김용빈", "김승후", "홍정의", "김민성", "하현성", "김진우2", "전은섭"],
        sisters: ["김유진", "이지희", "김민지", "임윤지", "박다은", "유재나", "김세연", "김채연", "임민해", "한예은", "임연주", "최연서", "한가은"]
      },
      {
        name: "사랑부",
        brothers: ["신창현", "임우혁", "정용진", "강민구", "노현준", "양홍열", "김해원", "백진호", "김교식", "이신섭", "조시형", "임향원", "심어진", "오서준", "임주용", "김도건", "이준희"],
        sisters: ["김혜련", "강민지", "최선영", "정희주", "박나은", "라유리", "하지원", "김호연", "유승비", "김주연", "강다빈", "이주화", "양정민", "한다빈", "유현지", "이다연"]
      }
    ];

    const today = new Date().toISOString().split("T")[0];
    const dashboard = document.getElementById("dashboard");

    
    let selectedDate = today;
    flatpickr("#datePicker", {
      locale: "ko",
      dateFormat: "Y-m-d",
      defaultDate: today,
      onChange: function(_, dateStr) {
        selectedDate = dateStr;
        renderAll();
      }
    });

    function renderAll() {
      dashboard.innerHTML = "";
      departments.forEach(dep => {
        const panel = document.createElement("div");
        panel.className = "panel";

        panel.innerHTML = `
          <h2>${dep.name}</h2>
          <div class="group">
            <div class="group-title">형제</div>
            <div class="names" id="${dep.name}_bros"></div>
          </div>
          <div class="group">
            <div class="group-title">자매</div>
            <div class="names" id="${dep.name}_siss"></div>
          </div>
        `;

        dashboard.appendChild(panel);

        db.ref("attendance/" + dep.name + "/" + selectedDate).get().then(snap => {
          const brosDiv = document.getElementById(dep.name + "_bros");
          const sissDiv = document.getElementById(dep.name + "_siss");

          dep.brothers.forEach((name, i) => {
            const div = document.createElement("div");
            div.className = "name";
            div.textContent = name;
            if (snap.exists() && snap.val().형제?.[i]) div.classList.add("present");
            brosDiv.appendChild(div);
          });

          dep.sisters.forEach((name, i) => {
            const div = document.createElement("div");
            div.className = "name";
            div.textContent = name;
            if (snap.exists() && snap.val().자매?.[i]) div.classList.add("present");
            sissDiv.appendChild(div);
          });
        });
      });
    }

    renderAll();

// Removed original render block
      const panel = document.createElement("div");
      panel.className = "panel";

      panel.innerHTML = `
        <h2>${dep.name}</h2>
        <div class="group">
          <div class="group-title">형제</div>
          <div class="names" id="${dep.name}_bros"></div>
        </div>
        <div class="group">
          <div class="group-title">자매</div>
          <div class="names" id="${dep.name}_siss"></div>
        </div>
      `;

      dashboard.appendChild(panel);

      db.ref("attendance/" + dep.name + "/" + today).get().then(snap => {
        const brosDiv = document.getElementById(dep.name + "_bros");
        const sissDiv = document.getElementById(dep.name + "_siss");

        dep.brothers.forEach((name, i) => {
          const div = document.createElement("div");
          div.className = "name";
          div.textContent = name;
          if (snap.exists() && snap.val().형제?.[i]) div.classList.add("present");
          brosDiv.appendChild(div);
        });

        dep.sisters.forEach((name, i) => {
          const div = document.createElement("div");
          div.className = "name";
          div.textContent = name;
          if (snap.exists() && snap.val().자매?.[i]) div.classList.add("present");
          sissDiv.appendChild(div);
        });
      });
    });
  </script>
</body>
</html>
