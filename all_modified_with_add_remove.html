
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ì „ì²´ ì¶œì„ í˜„í™© ë³´ê¸°</title>
<link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<style>
    body {
      margin: 0;
      padding: 8px 8px 80px 8px;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #f3e5f5, #e3f2fd);
    }
    h1 {
      text-align: center;
      margin-bottom: 4px;
      font-size: 24px;
      color: #333;
    }
    .date-picker {
      text-align: center;
      margin-bottom: 4px;
    }
    .date-picker input {
      padding: 8px 8px 48px 8px;
      font-size: 16px;
      border-radius: 6px;
      border: 1.5px solid #bbb;
      text-align: center;
    }
    
.dashboard {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  justify-content: center;
}

    
.panel {
  flex: 1 1 clamp(220px, 30vw, 360px);
  max-width: 100%;
  background: white;
  border-radius: 12px;
  padding: 6px 4px 10px 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
}

    .panel h2 {
      margin-bottom: 4px;
      font-size: 17px;
      color: #444;
    }
    .group {
      width: 100%;
      margin: 2px 0;
    }
    .group-title {
      display: flex; align-items: baseline;
      justify-content: center;
      gap: 2px;
      text-align: center;
      font-size: 10px;
      font-weight: bold;
      color: #666;
      margin: 0px 0;
    }
    .names {
  display: grid;
  grid-template-columns: repeat(1, 1fr);
  gap: 4px;
  justify-content: center;
}


}
@media (min-height: 501px) {
  .names {
  display: grid;
  grid-template-columns: repeat(1, 1fr);
  gap: 4px;
  justify-content: center;
}


}
    





.name {
  text-align: center;
  padding: 8px 2px;
  margin: 0;
  border-radius: 6px;
  font-size: clamp(14px, 2vw, 20px);
  background: #f7f7f7;
  border: 1.5px solid #bbb;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  letter-spacing: -0.2px;
  max-width: 100%;
  max-height: 100%;
  line-height: 1.3;
}


.name span {
  display: inline-block;
  max-width: 100%;
  font-size: inherit;
  transform: scaleX(1);
}

@media (max-height: 500px) {
  
.name {
  text-align: center;
  padding: 8px 2px;
  margin: 0;
  border-radius: 6px;
  font-size: clamp(14px, 2vw, 20px);
  background: #f7f7f7;
  border: 1.5px solid #bbb;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  letter-spacing: -0.2px;
  max-width: 100%;
  max-height: 100%;
  line-height: 1.3;
}

}





    .present {
  border: 1.5px solid #81c784;
  background: #e6f4ea !important;
  color: #2e7d32;
  font-weight: bold;
}
  
@media (orientation: portrait) {
  .name {
    font-size: clamp(12px, 1.5vw, 16px);
    padding: 4px 2px;
    line-height: 1.1;
  }
}
}


@media (orientation: landscape) {
  div[style*="ì „ì²´ì¶œì„í˜„í™©"] {
    font-size: 26px !important;
  }
}


@media (orientation: landscape) {
  div[style*="ì „ì²´ì¶œì„í˜„í™©"] {
    font-size: 32px !important;
    margin-top: 6px !important;
  }
}


@media (orientation: landscape) {
  .main-title {
    font-size: 32px !important;
    margin-top: 8px !important;
  }
}


@media (orientation: landscape) {
  .panel h2 {
    font-size: 20px !important;
  }
  .panel h2 span {
    font-size: 14px !important;
  }
  .group-title {
    font-size: 13px !important;
  }
  #totalSummary {
    font-size: 16px !important;
  }
}


@media (orientation: landscape) {
  #dateDisplay {
    font-size: 22px !important;
  letter-spacing: 1.2px !important;
  }
}


@media (orientation: portrait) {
  #totalSummary {
    font-size: 11px !important;
  }
}

</style>
<style>#datePicker {
  height: 26px !important;
  width: 80px !important;
  font-size: 15px !important;
  line-height: 26px !important;
  padding: 0 4px !important;
  margin: 0 !important;
  border: none !important;
  text-align: center !important;
  box-sizing: border-box !important;
  display: inline-block !important;
  vertical-align: middle !important;
}
.flatpickr-input {
  height: 26px !important;
  font-size: 15px !important;
  line-height: 26px !important;
  padding: 0 4px !important;
  margin: 0 !important;
}</style><style>
a.panel-link {
  text-decoration: none;
  color: inherit;
}
.panel-link 
.panel {
  flex: 1 1 clamp(220px, 30vw, 360px);
  max-width: 100%;
  background: white;
  border-radius: 12px;
  padding: 6px 4px 10px 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  align-items: center;
}

.panel-link:active .panel,
.panel:active {
  transform: scale(0.97);
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
</style><script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
<div id="dateDisplay" style="position: absolute; top: 36px; left: 50%; transform: translateX(-45%); font-size: 18px; font-weight: bold; visibility: hidden; z-index: 9999;position: absolute; top: 28px; left: 50%; transform: translateX(-50%); font-size: 18px; font-weight: bold; visibility: hidden; z-index: 9999;position: absolute; top: 4px; left: 50%; transform: translateX(-50%); font-size: 14px; font-weight: normal; visibility: hidden; z-index: 9999;"></div>
<button onclick="history.back()" style="position: absolute; top: 6px; left: 10px; background: #f3f7ff; color: #37474f;
    border: 1px solid #cfd8dc; padding: 6px 12px; font-size: 13px; border-radius: 6px; cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);">â†</button>
<div class="date-picker" style="display: flex; align-items: baseline; justify-content: center; align-items: center; gap: 8px;">
<button id="prevDay" style="padding: 4px 6px; font-size: 12px;">â—€</button>
<input id="datePicker" style="width: 30px; font-size: 11px; padding: 1px;" type="text"/>
<button id="nextDay" style="padding: 4px 6px; font-size: 12px;">â–¶</button>
</div>
<div class="main-title" style="display: flex; justify-content: center; position: relative; font-size: 20px; font-weight: bold; margin-top: 4px;">ì „ì²´ì¶œì„í˜„í™©
      </div>
<div id="totalSummary" style="text-align: right; font-size: 13px; color: #555; margin: 2px 4px 6px 0; "></div>
<div class="dashboard" id="dashboard">
<!-- Panels inserted by JS -->
</div>
<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDrHDHrYO2Z8tWmWRgWYcN4nWHwALZ4c0s",
      authDomain: "attendance-6b1b6.firebaseapp.com",
      databaseURL: "https://attendance-6b1b6-default-rtdb.firebaseio.com",
      projectId: "attendance-6b1b6",
      storageBucket: "attendance-6b1b6.appspot.com",
      messagingSenderId: "808077953334",
      appId: "1:808077953334:web:238afede21744aee6f8b97"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let departments = [];

    const dashboard = document.getElementById("dashboard");
    window.selectedDate = new Date().toISOString().split("T")[0];

    
    
function loadDepartments() {
  const deptNames = ["ê²¸ì†ë¶€", "ì˜¨ìœ ë¶€", "ì‚¬ë‘ë¶€"];
  const promises = deptNames.map(name =>
    db.ref("attendance/" + name + "/ëª…ë‹¨").get().then(snap => {
      const data = snap.val() || {};
      return {
        name,
        brothers: data.í˜•ì œ || [],
        sisters: data.ìë§¤ || []
      };
    })
  );
  return Promise.all(promises).then(results => {
    departments = results;
    renderAll();
  });
}

function renderAll() {
      dashboard.innerHTML = ""; // Clear all panels first
      departments.forEach(dep => {
        
      const panelLink = document.createElement("a");
      panelLink.className = "panel-link";

      if (dep.name === "ê²¸ì†ë¶€") panelLink.href = "attendance_firebase_gyeomsonbu_scoped.html";
      else if (dep.name === "ì˜¨ìœ ë¶€") panelLink.href = "attendance_firebase_onyubu_scoped.html";
      else if (dep.name === "ì‚¬ë‘ë¶€") panelLink.href = "attendance_firebase_sarangbu_scoped.html";

      const panel = document.createElement("div");
      panel.className = "panel";
        panel.innerHTML = `
          <h2>${dep.name} <span id="${dep.name}_total" style="font-size: 13px; color: #666;"></span></h2>
          
          <div style="display: flex; align-items: baseline; gap: 6px; width: 100%;">
            <div style="flex: 1;">
              <div class="group-title">í˜•ì œ <span class="count" id="${dep.name}_bros_count"></span></div>
              <div class="names" id="${dep.name}_bros"></div>
            </div>
            <div style="flex: 1;">
              <div class="group-title">ìë§¤ <span class="count" id="${dep.name}_siss_count"></span></div>
              <div class="names" id="${dep.name}_siss"></div>
            </div>
          </div>

<div style="margin-top: 8px; text-align: center;">
  <button onclick="addPerson(dep.name, 'í˜•ì œ')">+ í˜•ì œ ì¶”ê°€</button>
  <button onclick="addPerson(dep.name, 'ìë§¤')">+ ìë§¤ ì¶”ê°€</button>
  <button onclick="removePerson(dep.name, 'í˜•ì œ')">í˜•ì œ ì‚­ì œ</button>
  <button onclick="removePerson(dep.name, 'ìë§¤')">ìë§¤ ì‚­ì œ</button>
</div>
        `;
        panelLink.appendChild(panel);
        dashboard.appendChild(panelLink);

        const brosDiv = document.getElementById(dep.name + "_bros");
        const sissDiv = document.getElementById(dep.name + "_siss");

        const ref = db.ref("attendance/" + dep.name + "/" + selectedDate);
        ref.off();
        ref.on("value", snap => {
          let broCount = 0;
          let sisCount = 0;

          brosDiv.innerHTML = "";
          dep.brothers.forEach((name, i) => {
            const div = document.createElement("div");
            div.className = "name";
            div.innerHTML = `<span>${name}</span>`;
            if (snap.exists() && snap.val().í˜•ì œ?.[i]) { div.classList.add("present"); broCount++; }
            brosDiv.appendChild(div);
          });

          sissDiv.innerHTML = "";
          dep.sisters.forEach((name, i) => {
            const div = document.createElement("div");
            div.className = "name";
            div.innerHTML = `<span>${name}</span>`;
            if (snap.exists() && snap.val().ìë§¤?.[i]) { div.classList.add("present"); sisCount++; }
            sissDiv.appendChild(div);
          });

          document.querySelector(`#${dep.name}_bros`).previousElementSibling.querySelector('.count').textContent = `${broCount}ëª…`;
          document.querySelector(`#${dep.name}_siss`).previousElementSibling.querySelector('.count').textContent = `${sisCount}ëª…`;
          const totalSpan = document.getElementById(`${dep.name}_total`);
          if (totalSpan) totalSpan.textContent = `ì´ ${broCount + sisCount}ëª…`;

          updateTotalSummary();
        });
      });
    }

    function updateTotalSummary() {
      let totalBro = 0;
      let totalSis = 0;

      departments.forEach(dep => {
        const ref = db.ref("attendance/" + dep.name + "/" + selectedDate);
        ref.get().then(snap => {
          const bros = snap.val()?.í˜•ì œ || [];
          const siss = snap.val()?.ìë§¤ || [];
          totalBro += bros.filter(x => x).length;
          totalSis += siss.filter(x => x).length;

          if (dep.name === "ì‚¬ë‘ë¶€") {
            const total = totalBro + totalSis;
            document.getElementById("totalSummary").textContent = `ì¶œì„ ì´ ${total}ëª… (í˜•ì œë‹˜ ${totalBro}ëª…, ìë§¤ë‹˜ ${totalSis}ëª…)`;
          }
        });
      });
    }
    flatpickr("#datePicker", {
      locale: "ko",
      dateFormat: "Y-m-d",
      defaultDate: selectedDate,
      onChange: function(_, dateStr) {
        window.selectedDate = dateStr;
        document.getElementById("dateDisplay").textContent = formatDateWithDay(dateStr);
        selectedDate = dateStr;
        loadDepartments();
    // Total summary calculation
    let totalBro = 0;
    let totalSis = 0;

    departments.forEach(dep => {
      db.ref("attendance/" + dep.name + "/" + selectedDate).get().then(snap => {
        const bros = snap.val()?.í˜•ì œ || [];
        const siss = snap.val()?.ìë§¤ || [];
        totalBro += bros.filter(x => x).length;
        totalSis += siss.filter(x => x).length;

        // After last department
        if (dep.name === "ì‚¬ë‘ë¶€") {
          const total = totalBro + totalSis;
          document.getElementById("totalSummary").textContent = `ì¶œì„ ì´ ${total}ëª… (í˜•ì œë‹˜ ${totalBro}ëª…, ìë§¤ë‹˜ ${totalSis}ëª…)`;
        }
      });
    });


    document.getElementById("prevDay").onclick = () => changeDate(-1);
    document.getElementById("nextDay").onclick = () => changeDate(1);

    function changeDate(offset) {
      const d = new Date(selectedDate);
      d.setDate(d.getDate() + offset);
      selectedDate = d.toISOString().split("T")[0];
      document.getElementById("datePicker")._flatpickr.setDate(selectedDate, true);
      loadDepartments();
    // Total summary calculation
    let totalBro = 0;
    let totalSis = 0;

    departments.forEach(dep => {
      db.ref("attendance/" + dep.name + "/" + selectedDate).get().then(snap => {
        const bros = snap.val()?.í˜•ì œ || [];
        const siss = snap.val()?.ìë§¤ || [];
        totalBro += bros.filter(x => x).length;
        totalSis += siss.filter(x => x).length;

        // After last department
        if (dep.name === "ì‚¬ë‘ë¶€") {
          const total = totalBro + totalSis;
          document.getElementById("totalSummary").textContent = `ì¶œì„ ì´ ${total}ëª… (í˜•ì œë‹˜ ${totalBro}ëª…, ìë§¤ë‹˜ ${totalSis}ëª…)`;
        }
      });
    });

    }

      }
    });

    loadDepartments();
    // Total summary calculation
    let totalBro = 0;
    let totalSis = 0;

    departments.forEach(dep => {
      db.ref("attendance/" + dep.name + "/" + selectedDate).get().then(snap => {
        const bros = snap.val()?.í˜•ì œ || [];
        const siss = snap.val()?.ìë§¤ || [];
        totalBro += bros.filter(x => x).length;
        totalSis += siss.filter(x => x).length;

        // After last department
        if (dep.name === "ì‚¬ë‘ë¶€") {
          const total = totalBro + totalSis;
          document.getElementById("totalSummary").textContent = `ì¶œì„ ì´ ${total}ëª… (í˜•ì œë‹˜ ${totalBro}ëª…, ìë§¤ë‹˜ ${totalSis}ëª…)`;
        }
      });
    });


    document.getElementById("prevDay").onclick = () => changeDate(-1);
    document.getElementById("nextDay").onclick = () => changeDate(1);

    function changeDate(offset) {
      const d = new Date(selectedDate);
      d.setDate(d.getDate() + offset);
      selectedDate = d.toISOString().split("T")[0];
      document.getElementById("datePicker")._flatpickr.setDate(selectedDate, true);
      loadDepartments();
    // Total summary calculation
    let totalBro = 0;
    let totalSis = 0;

    departments.forEach(dep => {
      db.ref("attendance/" + dep.name + "/" + selectedDate).get().then(snap => {
        const bros = snap.val()?.í˜•ì œ || [];
        const siss = snap.val()?.ìë§¤ || [];
        totalBro += bros.filter(x => x).length;
        totalSis += siss.filter(x => x).length;

        // After last department
        if (dep.name === "ì‚¬ë‘ë¶€") {
          const total = totalBro + totalSis;
          document.getElementById("totalSummary").textContent = `ì¶œì„ ì´ ${total}ëª… (í˜•ì œë‹˜ ${totalBro}ëª…, ìë§¤ë‹˜ ${totalSis}ëª…)`;
        }
      });
    });

    }

  </script>
<button onclick="captureScreen()" style="
  position: fixed;
  top: 8px;
  right: 12px;
  background: #fff3e0;
  color: #5d4037;
  border: 1px solid #d7ccc8;
  padding: 7px 8px;
  font-size: 11px;
  border-radius: 5px;
  cursor: pointer;
  z-index: 9999;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
">í™”ë©´ ìº¡ì³</button>
<script>
function captureScreen() {
  // ìˆ¨ê¸¸ ìš”ì†Œë“¤
  const elementsToHide = [
    document.querySelector(".date-picker"),
    document.querySelector("button[onclick='history.back()']"),
    document.querySelector("button[onclick='captureScreen()']")
  ];

  // ìˆ¨ê¹€ ì²˜ë¦¬
  elementsToHide.forEach(el => { if (el) el.style.visibility = "hidden"; });
  const dateEl = document.getElementById("dateDisplay"); if (dateEl) dateEl.style.visibility = "visible";

  // ì ì‹œ í›„ ìº¡ì³
  setTimeout(() => {
    html2canvas(document.body).then(canvas => {
      const link = document.createElement("a");
      link.download = `attendance_${new Date().toISOString().slice(0,10)}.png`;
      link.href = canvas.toDataURL("image/png");
      link.click();

      // ë‹¤ì‹œ ë³´ì´ê²Œ ë³µì›
      elementsToHide.forEach(el => { if (el) el.style.visibility = "visible"; });
      if (dateEl) dateEl.style.visibility = "hidden";
    });
  }, 300);
}
</script>
<script>
function formatDateWithDay(dateStr) {
  const date = new Date(dateStr);
  const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
  const day = days[date.getDay()];
  return dateStr + `(${day})`;
}
document.addEventListener("DOMContentLoaded", () => {
  const display = document.getElementById("dateDisplay");
  if (display && window.selectedDate) {
    display.textContent = formatDateWithDay(window.selectedDate);
  }
});

// ìŠ¤ì™€ì´í”„ ì´ë²¤íŠ¸ ì¶”ê°€
let touchStartX = 0;
let touchEndX = 0;

document.addEventListener('touchstart', function(e) {
  touchStartX = e.changedTouches[0].screenX;
}, false);

document.addEventListener('touchend', function(e) {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipeGesture();
}, false);

function handleSwipeGesture() {
  const swipeDistance = touchEndX - touchStartX;
  if (Math.abs(swipeDistance) > 50) { // ìµœì†Œ ìŠ¤ì™€ì´í”„ ê±°ë¦¬
    if (swipeDistance > 0) {
      // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ â†’ ì´ì „ ë‚ ì§œ
      changeDate(-1);
    } else {
      // ì™¼ìª½ ìŠ¤ì™€ì´í”„ â†’ ë‹¤ìŒ ë‚ ì§œ
      changeDate(1);
    }
  }
}


<script>
// ğŸ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸
function verifyPassword() {
  const input = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  return input === "9191";
}

// â• ì¸ì› ì¶”ê°€
function addPerson(department, gender) {
  if (!verifyPassword()) {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    return;
  }

  const name = prompt(`${department} ${gender} ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:`);
  if (!name || name.trim() === "") return;

  const ref = db.ref(`attendance/${department}/ëª…ë‹¨/${gender}`);
  ref.once("value").then(snapshot => {
    const list = snapshot.val() || [];
    list.push(name);
    ref.set(list).then(() => {
      alert(`${name}ë‹˜ì´ ${department} ${gender}ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      loadDepartments(); // UI ìƒˆë¡œê³ ì¹¨
    });
  });
}

// â– ì¸ì› ì‚­ì œ
function removePerson(department, gender) {
  if (!verifyPassword()) {
    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
    return;
  }

  const name = prompt(`ì‚­ì œí•  ${department} ${gender} ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”:`);
  if (!name || name.trim() === "") return;

  const ref = db.ref(`attendance/${department}/ëª…ë‹¨/${gender}`);
  ref.once("value").then(snapshot => {
    let list = snapshot.val() || [];
    const idx = list.indexOf(name);
    if (idx === -1) {
      alert(`${name}ë‹˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
      return;
    }
    list.splice(idx, 1);
    ref.set(list).then(() => {
      alert(`${name}ë‹˜ì´ ${department} ${gender}ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
      // ì¶œì„ ì •ë³´ë„ í•´ë‹¹ indexì—ì„œ ì œê±°
      const attendanceRef = db.ref(`attendance/${department}/${selectedDate}/${gender}`);
      attendanceRef.once("value").then(snap => {
        const arr = snap.val() || [];
        arr.splice(idx, 1);
        attendanceRef.set(arr);
      });
      loadDepartments();
    });
  });
}
</script>

</body>
</html>
