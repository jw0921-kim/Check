
<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>ì¶œì„ë¶€ Firebase ì—°ë™</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
<style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #e3f2fd 0%, #fff0f5 100%);
      margin: 0;
      padding: 16px;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 12px;
      font-size: 1.4rem;
      color: #555;
    }
    .top-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }
    .top-controls button, .top-controls input {
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 6px;
    }
    .summary {
      text-align: center;
      font-weight: 600;
      margin: 10px 0 18px;
      font-size: 0.95rem;
    }
    .group-container {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .group {
      background: #ffffff;
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      max-width: 360px;
      flex: 1;
    }
    .group h2 {
      text-align: center;
      margin-bottom: 12px;
      font-size: 1.1rem;
      color: #666;
    }
    .names {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    .name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 7px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.9rem;
      background: #f0f0f0;
    }
    .name.present {
      transform: scale(1.03);
      background: #e6f4ea;
      border: 2px solid #aed581;
      font-weight: bold;
      color: #33691e;
    }
    .bottom-controls {
      position: fixed;
      bottom: 20px;
      left: 20px;
      display: flex;
      gap: 10px;
    }
    .bottom-controls button {
      background: #fff3e0;
      padding: 8px 12px;
      font-size: 13px;
      color: #6d4c41;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .back-btn {
      position: absolute;
      top: 12px;
      left: 12px;
      background: #f3f7ff;
      color: #37474f;
      border: 1px solid #cfd8dc;
      padding: 6px 12px;
      font-size: 13px;
      border-radius: 6px;
      cursor: pointer;
    }
  
.toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: #323232;
  color: #fff;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 9999;
}
.toast.show {
  opacity: 1;
}


.bottom-right-controls {
  position: fixed;
  bottom: 20px;
  right: 20px;
}
.bottom-right-controls button {
  background: #e0f7fa;
  color: #006064;
  padding: 8px 12px;
  font-size: 13px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}


button {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  cursor: pointer;
  padding: 8px 12px;
  font-size: 13px;
  border-radius: 6px;
  border: none;
}
#undoBtn, #redoBtn {
  background: #fff3e0;
  color: #6d4c41;
}
#copyBtn {
  background: #e0f7fa;
  color: #006064;
}

.bottom-controls, .bottom-right-controls {
  z-index: 1000;
}

.bottom-controls button, .bottom-right-controls button {
  min-width: 80px;
}

.toast {
  pointer-events: none;
}

#copyBtn {
  width: 64px;
  padding: 8px 6px;
}

#copyBtn {
  width: 52px;
  padding: 6px 4px;
  font-size: 12px;
}

#clearAllBtn {
  height: 32px;
  width: auto;
  padding: 6px 10px;
  font-size: 13px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

#copyBtn {
  height: 32px;
  width: auto;
  padding: 6px 10px;
  font-size: 13px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

#undoBtn, #redoBtn {
  height: 32px;
  width: auto;
  padding: 6px 10px;
  font-size: 13px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.bottom-right-controls {
  position: fixed;
  bottom: 20px;
  right: 12px;
  display: flex;
  justify-content: flex-end;
}

#copyBtn {
  height: 32px;
  width: auto;
  padding: 6px 6px;
  font-size: 13px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

#copyBtn {
  padding: 6px 4px;  /* reduce left/right padding */
}

#copyBtn {
  padding: 4px 1px !important;  /* ê°€ì¥ ìµœì†Œì˜ íŒ¨ë”© */
  width: fit-content !important; /* ê¸€ì í¬ê¸°ì— ë§ì¶”ê¸° */
  white-space: nowrap !important;
}

#copyBtn {
  padding: 4px 2px !important; /* íŒ¨ë”©ì„ ìµœì†Œí™”í•˜ì—¬ ì¢ê²Œ ì„¤ì • */
  width: auto !important;
  white-space: nowrap !important;
}

#undoBtn, #redoBtn {
  padding: 6px 10px !important; /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ */
}

#copyBtn {
  padding: 3px 1px !important; /* ê°€ëŠ¥í•œ ìµœì†Œ íŒ¨ë”© */
  width: fit-content !important; /* ì •í™•íˆ ê¸€ì ë„ˆë¹„ì— ë§ì¶¤ */
  min-width: unset !important;
  white-space: nowrap !important;
  box-sizing: content-box !important;
}

.bottom-right-controls {
  right: 12px;
  bottom: 20px;
  display: flex;
  justify-content: flex-end;
  width: auto !important;
}

#copyBtn {
  padding: 4px 8px !important; /* ì¢Œìš° ì—¬ë°± ì ë‹¹íˆ ì¡°ì • */
  width: fit-content !important;
  box-sizing: content-box !important;
}

#copyBtn {
  padding: 4px 8px !important;
  width: calc(2em + 16px) !important; /* "ë³µì‚¬ë³µì‚¬" ê¸€ì”¨ í¬ê¸°ë§Œí¼ ë„ˆë¹„ ì„¤ì • */
  text-align: center !important;
  justify-content: center !important;
  display: inline-flex !important;
  box-sizing: content-box !important;
}

#copyBtn, #clearAllBtn {
  height: 32px !important; /* ë™ì¼í•œ ì„¸ë¡œ ë†’ì´ë¡œ ì„¤ì • */
  padding-top: 0 !important;
  padding-bottom: 0 !important;
  display: inline-flex !important;
  align-items: center !important; /* ìˆ˜ì§ ì •ë ¬ */
  justify-content: center !important; /* ìˆ˜í‰ ì •ë ¬ */
  box-sizing: border-box !important;
}

#copyBtn {
  width: calc(3em + 24px) !important; /* ê¸°ì¡´ë³´ë‹¤ ë” ëŠ˜ë¦¼ */
}
</style>
</head>
<body>
<button class="back-btn" onclick="history.back()">â† ë’¤ë¡œê°€ê¸°</button>
<h1>ğŸ“‹ ëŒ€í•™ë¶€</h1>
<div class="top-controls">
<button id="prevDay">â—€</button>
<input id="datePicker" type="text"/>
<button id="nextDay">â–¶</button>
</div>
<div class="summary" id="summary">ì´ ì¶œì„: 0ëª…</div>
<div class="group-container">
<div class="group">
<h2>í˜•ì œ <span id="broCount"></span></h2>
<div class="names" id="brothers"></div>
</div>
<div class="group">
<h2>ìë§¤ <span id="sisCount"></span></h2>
<div class="names" id="sisters"></div>
</div>
</div>
<div class="bottom-controls">
<button id="clearAllBtn">ì „ì²´ ì„ íƒ í•´ì œ</button>
<button id="undoBtn">ë˜ëŒë¦¬ê¸°</button>
<button id="redoBtn">ë‹¤ì‹œ ì‹¤í–‰</button>
</div>
<div class="bottom-right-controls">
<button id="copyBtn">ë³µì‚¬</button>
</div>
<script>
  function formatNamesWithLineBreak(names) {
    return names.map((name, i) => (i > 0 && i % 5 === 0 ? "\n" : "") + name).join(", ");
  }

  const firebaseConfig = {
    apiKey: "AIzaSyDrHDHrYO2Z8tWmWRgWYcN4nWHwALZ4c0s",
    authDomain: "attendance-6b1b6.firebaseapp.com",
    databaseURL: "https://attendance-6b1b6-default-rtdb.firebaseio.com",
    projectId: "attendance-6b1b6",
    storageBucket: "attendance-6b1b6.appspot.com",
    messagingSenderId: "808077953334",
    appId: "1:808077953334:web:238afede21744aee6f8b97"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let brothers = [];
  let sisters = [];
  let currentDate = new Date().toISOString().split("T")[0];

  const datePicker = document.getElementById("datePicker");
  const summary = document.getElementById("summary");
  const broCountEl = document.getElementById("broCount");
  const sisCountEl = document.getElementById("sisCount");
  const brothersDiv = document.getElementById("brothers");
  const sistersDiv = document.getElementById("sisters");

  let undoStack = [];
  let redoStack = [];

  function getCurrentState() {
    return {
      í˜•ì œ: brothers.map((_, i) => brothersDiv.children[i].classList.contains("present")),
      ìë§¤: sisters.map((_, i) => sistersDiv.children[i].classList.contains("present"))
    };
  }

  function applyState(state) {
    state.í˜•ì œ.forEach((v, i) => brothersDiv.children[i]?.classList.toggle("present", v));
    state.ìë§¤.forEach((v, i) => sistersDiv.children[i]?.classList.toggle("present", v));
    updateSummary();
    saveToFirebase();
  }

  function pushUndoState() {
    undoStack.push(getCurrentState());
    redoStack = [];
  }

  function createTag(name) {
    const div = document.createElement("div");
    div.className = "name";
    div.textContent = name;
    div.onclick = () => {
      pushUndoState();
      div.classList.toggle("present");
      updateSummary();
      saveToFirebase();
    };
    return div;
  }

  function fetchNames() {
    return db.ref("attendance/ëŒ€í•™ë¶€/ëª…ë‹¨").get().then(snap => {
      const data = snap.val() || {};
      brothers = data.í˜•ì œ || [];
      sisters = data.ìë§¤ || [];
    });
  }

  function render() {
    brothersDiv.innerHTML = "";
    sistersDiv.innerHTML = "";
    brothers.forEach(name => brothersDiv.appendChild(createTag(name)));
    sisters.forEach(name => sistersDiv.appendChild(createTag(name)));
  }

  function updateSummary() {
    const b = [...brothersDiv.children].filter(c => c.classList.contains("present")).length;
    const s = [...sistersDiv.children].filter(c => c.classList.contains("present")).length;
    summary.textContent = `ì´ ì¶œì„: ${b + s}ëª…`;
    broCountEl.textContent = b ? `${b}ëª…` : "";
    sisCountEl.textContent = s ? `${s}ëª…` : "";
  }

  function saveToFirebase() {
    const bro = brothers.map((_, i) => brothersDiv.children[i].classList.contains("present"));
    const sis = sisters.map((_, i) => sistersDiv.children[i].classList.contains("present"));
    db.ref("attendance/ëŒ€í•™ë¶€/" + currentDate).set({ í˜•ì œ: bro, ìë§¤: sis });
  }

  function listenToFirebase() {
    db.ref("attendance/ëŒ€í•™ë¶€/" + currentDate).on("value", snap => {
      if (!snap.exists()) return updateSummary();
      const data = snap.val();
      brothers.forEach((_, i) => {
        brothersDiv.children[i]?.classList.toggle("present", !!data.í˜•ì œ?.[i]);
      });
      sisters.forEach((_, i) => {
        sistersDiv.children[i]?.classList.toggle("present", !!data.ìë§¤?.[i]);
      });
      updateSummary();
    });
  }

  function changeDate(offset) {
  undoStack = [];
  redoStack = [];
    db.ref("attendance/ëŒ€í•™ë¶€/" + currentDate).off();
    const d = new Date(currentDate);
    d.setDate(d.getDate() + offset);
    currentDate = d.toISOString().split("T")[0];
    datePicker._flatpickr.setDate(currentDate, true);
    fetchNames().then(() => { render(); listenToFirebase(); });


function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2000);
}


  const freshmen = ["ì˜¤ì„œì¤€", "ê¹€ë„ê±´", "ê¹€ì§„ìš°", "í•œê°€ì€", "ì´ë‹¤ì—°", "ê¹€ë‘í˜„"];

  document.getElementById("copyBtn").onclick = () => {
    const broNames = [...document.querySelectorAll("#brothers .present")].map(el => el.textContent);
    const sisNames = [...document.querySelectorAll("#sisters .present")].map(el => el.textContent);
    const freshNames = [...broNames, ...sisNames].filter(name => freshmen.includes(name));
    const broFinal = broNames.filter(name => !freshNames.includes(name));
    const sisFinal = sisNames.filter(name => !freshNames.includes(name));

    const date = new Date(currentDate);
    const day = date.toLocaleDateString("ko-KR", { year: "2-digit", month: "2-digit", day: "2-digit", weekday: "short" })
                  .replaceAll(".", "").replace(" ", " (") + ")";

    let text = `â˜˜ï¸${day} ëŒ€í•™ì„ êµë¶€ ì¶œì„â˜˜ï¸\n\n`;
    if (broFinal.length) text += `í˜•ì œë‹˜ğŸ™‹ğŸ»â€â™‚ï¸\n${formatNamesWithLineBreak(broFinal)}\n\n`;
    if (sisFinal.length) text += `ìë§¤ë‹˜ğŸ™‹ğŸ»â€â™€ï¸\n${formatNamesWithLineBreak(sisFinal)}\n\n`;
    if (freshNames.length) text += `ğŸ’›ì‹ ì…ìƒğŸ’›\n${formatNamesWithLineBreak(freshNames)}\n\n`;
    if (broFinal.length) text += `í˜•ì œë‹˜: ${broFinal.length}ëª…\n`;
    if (sisFinal.length) text += `ìë§¤ë‹˜: ${sisFinal.length}ëª…\n`;
    if (freshNames.length) text += `ì‹ ì…ìƒ: ${freshNames.length}ëª…\n`;
    const total = broFinal.length + sisFinal.length + freshNames.length;
    text += `\nì´ â€œ${total}ëª…â€ ì°¸ì„í•˜ì˜€ìŠµë‹ˆë‹¤`;

    navigator.clipboard.writeText(text).then(() => {
      const toast = document.getElementById("toast");
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2000);
    });
  };

  }

  document.getElementById("prevDay").onclick = () => changeDate(-1);
  document.getElementById("nextDay").onclick = () => changeDate(1);
  document.getElementById("clearAllBtn").onclick = () => {
    pushUndoState();
    [...brothersDiv.children].forEach(c => c.classList.remove("present"));
    [...sistersDiv.children].forEach(c => c.classList.remove("present"));
    updateSummary();
    saveToFirebase();
  };
  
document.getElementById("undoBtn").onclick = () => {
  if (undoStack.length === 0) return showToast("ë˜ëŒë¦´ ì‘ì—…ì´ ì—†ì–´ìš”");
  redoStack.push(getCurrentState());
  const prev = undoStack.pop();
  applyState(prev);
  showToast("ë˜ëŒë ¸ì–´ìš”");
};
  
document.getElementById("redoBtn").onclick = () => {
  if (redoStack.length === 0) return showToast("ë‹¤ì‹œ ì‹¤í–‰í•  ì‘ì—…ì´ ì—†ì–´ìš”");
  undoStack.push(getCurrentState());
  const next = redoStack.pop();
  applyState(next);
  showToast("ë‹¤ì‹œ ì‹¤í–‰í–ˆì–´ìš”");
};

  flatpickr(datePicker, {
    locale: "ko",
    dateFormat: "Y-m-d",
    defaultDate: currentDate,
    onChange: (_, dateStr) => {
      db.ref("attendance/ëŒ€í•™ë¶€/" + currentDate).off();
      render();
      currentDate = dateStr;
      fetchNames().then(() => { render(); listenToFirebase(); });


function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2000);
}


  const freshmen = ["ì˜¤ì„œì¤€", "ê¹€ë„ê±´", "ê¹€ì§„ìš°", "í•œê°€ì€", "ì´ë‹¤ì—°", "ê¹€ë‘í˜„"];


    }
  });

  fetchNames().then(() => { render(); listenToFirebase(); });


function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2000);
}


  const freshmen = ["ì˜¤ì„œì¤€", "ê¹€ë„ê±´", "ê¹€ì§„ìš°", "í•œê°€ì€", "ì´ë‹¤ì—°", "ê¹€ë‘í˜„"];


</script>
<div class="toast" id="toast">í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨!</div>
</body>
</html>
